# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Shopify theme for Rejuvia, an e-commerce site selling sleep and wellness products. The theme is built using Shopify's Liquid templating language with custom JavaScript and CSS.

## Architecture

### Directory Structure

- **`sections/`** (61 files) - Reusable Shopify sections that can be added to pages via the theme editor. Key sections include:
  - `header.liquid` - Main site header with navigation
  - `footer.liquid` - Site footer
  - `cart-main.liquid` - Shopping cart interface
  - `product-widget.liquid` - Product display with Skio subscription integration

- **`snippets/`** (171 files) - Smaller reusable Liquid components. Key snippets include:
  - `_product.liquid` - Main product display logic with subscription support
  - `_product_variants.liquid` / `_product_variants2.liquid` / `_product_variants3.liquid` - Product variant selectors
  - `_product_gallery.liquid` - Product image gallery
  - `side_cart.liquid` - Side cart drawer functionality
  - Multiple Replo page builder chunks (`reploChunk.*.liquid`)

- **`templates/`** (38 files) - Page templates in both Liquid and JSON formats
  - `product.json` / `product.*.json` - Product page templates (multiple variants)
  - `cart.json` - Cart page configuration
  - `collection.json` / `collection.new.json` - Collection pages
  - `page.*.json` - Various landing pages (FAQ, ingredients, etc.)
  - `customers/` - Customer account templates

- **`layout/`** - Base layout files
  - `theme.liquid` - Main theme wrapper with head/body structure

- **`assets/`** - Static assets (CSS, JS, images)
  - `custom.js` - Main custom JavaScript
  - `ProductJs.js` - Product-specific functionality
  - `simplistic.js` - Core theme JavaScript
  - `vendor.js` - Third-party libraries
  - Component-specific CSS/JS (e.g., `customer-testimonials.js/css`)

- **`config/`** - Theme configuration
  - `settings_schema.json` - Theme settings definitions (sticky header, container width, etc.)
  - `settings_data.json` - Actual theme settings values

- **`locales/`** - Translation files
  - `en.default.json` - English translations with custom checkout text

### Key Integrations

- **Skio** - Subscription management (see `{% render 'skio-head' %}` in theme.liquid)
- **Replo** - Page builder for landing pages (many `page.replo.*.liquid` templates)
- **Okendo** - Product reviews (referenced in cart.json)
- **Recharge** - Legacy subscription system (still referenced in some snippets)
- **jQuery** - Used extensively throughout the theme
- **AOS (Animate On Scroll)** - Scroll animations library
- **PhotoSwipe** - Image lightbox for product galleries

### Product Display System

The theme uses multiple product template variations:
- Standard product pages with one-time purchase
- Subscription-enabled products (via Skio/Recharge)
- Product variants handled through `_product_variants.liquid` family
- Metafields drive subscription discounts: `product.metafields.subscriptions.discount_percentage`

### Cart System

- Main cart: `sections/cart-main.liquid`
- Side cart drawer: `snippets/side_cart.liquid`
- Cart offers/upsells: `sections/cart_offers.liquid`
- Side cart can be enabled via theme settings: `settings.allow_side_cart`

### Styling Approach

- Custom CSS is primarily inline within Liquid files (see product snippets)
- Component-specific stylesheets in `assets/`
- Uses CSS variables for theming (e.g., `settings.content_text_color`)
- Responsive breakpoints: Mobile (<= 900px), Desktop (> 900px)

## Development Commands

Since this is a Shopify theme, development requires the Shopify CLI:

### Theme Development

```bash
# Start local development server
shopify theme dev

# Push theme to Shopify
shopify theme push

# Pull theme from Shopify
shopify theme pull

# Deploy to production
shopify theme push --theme <theme-id>
```

### Working with Assets

When modifying JavaScript or CSS files in `assets/`, changes will be reflected immediately with `shopify theme dev`. The development server provides a local preview with hot reloading.

## Important Notes

### Template JSON Files

Many templates use JSON format (e.g., `cart.json`, `product.json`) which reference sections and configure their settings. These are auto-generated by the Shopify theme editor - modifications should be made carefully.

### Liquid Context

- Product data: Available via `product` object in product templates
- Cart data: Available via `cart` object
- Theme settings: Access via `settings` object (e.g., `settings.sticky_header_desktop`)
- Metafields: Accessed via `product.metafields.namespace.key`

### JavaScript Dependencies

The theme loads scripts in this order (see `layout/theme.liquid:27-74`):
1. jQuery (`jquery.min.js`)
2. lazysizes for image loading
3. `simplistic.js` - core theme functionality
4. `vendor.js` - third-party libraries
5. `ProductJs.js` - product page logic
6. Shopify API (`api.jquery.js`)
7. `custom.js` - custom functionality

### Subscription Logic

Products with subscriptions use:
- Skio plan picker (`sections/product-widget.liquid:skio-plan-picker`)
- Discount calculation based on `subscription_product.discount_percentage` metafield
- RC (Recharge) container styling for subscription options (see `_product.liquid:31-39`)

### Custom Checkout

The theme customizes checkout text via `locales/en.default.json:17-18`:
- Custom terms agreement text mentions "Rejuvia's terms of sale"
- Custom security notice text

### Header Behavior

- Sticky header configurable separately for desktop and mobile
- Header slides up on scroll to hide utility bar (see `layout/theme.liquid:125-131`)
- Utility bar height: `$utilityBar.outerHeight()`

## Common Tasks

### Adding a New Section
1. Create `sections/your-section.liquid`
2. Add schema at bottom of file for settings
3. Use in templates via `{% section 'your-section' %}`

### Modifying Product Display
- Edit `snippets/_product.liquid` for main product template
- Edit `snippets/_product-new.liquid` for newer variant
- Product-specific templates: `templates/product.*.json`

### Updating Cart Functionality
- Cart page: `sections/cart-main.liquid`
- Side cart: `snippets/side_cart.liquid`
- Cart JavaScript: Look for cart-related functions in `custom.js`

**Important:** When removing cart items with subscription selling plans, use `/cart/change.js` with the item `id` or `line` parameter instead of `/cart/update.js`. The `/cart/update.js` endpoint returns 422 errors when trying to set subscription items to quantity 0.

### Working with Replo Pages
Replo-generated pages are in `templates/page.replo.*.liquid`. These are managed through the Replo app and should not be manually edited unless necessary.
