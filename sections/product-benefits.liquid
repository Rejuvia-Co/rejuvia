{{ 'product-benefits.css' | asset_url | stylesheet_tag }}

{%- assign benefits_section = product.metafields.custom.product_benefits -%}

{%- if benefits_section.value != blank -%}
<section class="product-benefits-section" id="product-benefits-{{ section.id }}">
  <div class="product-benefits__container">
    {%- if benefits_section.value.heading != blank -%}
      <h2 class="product-benefits__heading">{{ benefits_section.value.heading }}</h2>
    {%- endif -%}

    <div class="product-benefits__content">
      {%- comment -%} Access benefits list {%- endcomment -%}
      {%- assign benefits_list = benefits_section.value.benefits -%}

      {%- comment -%} Debug: Show count {%- endcomment -%}
      <!-- Benefits count: {{ benefits_list.size }} -->

      {%- assign left_benefits = benefits_list | slice: 0, 2 -%}
      {%- assign right_benefits = benefits_list | slice: 2, 2 -%}

      {%- comment -%} Left Benefits Column {%- endcomment -%}
      <div class="product-benefits__left">
        {%- for benefit in left_benefits -%}
          <!-- Benefit title: "{{ benefit.title }}" -->
          <div class="product-benefits__item">
            <div class="product-benefits__item-header">
              <span class="product-benefits__checkmark">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
              </span>
              <h3 class="product-benefits__title">{{ benefit.title }}</h3>
            </div>
            {%- if benefit.description != blank -%}
              <p class="product-benefits__description">{{ benefit.description | newline_to_br }}</p>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </div>

      {%- comment -%} Center Image {%- endcomment -%}
      <div class="product-benefits__image-container">
        <div class="product-benefits__decorative-dots">
          {% render 'dots' %}
        </div>
        {%- if benefits_section.value.image != blank -%}
          {{ benefits_section.value.image | image_url: width: 600 | image_tag: class: 'product-benefits__image', loading: 'lazy' }}
        {%- endif -%}
      </div>

      {%- comment -%} Right Benefits Column {%- endcomment -%}
      <div class="product-benefits__right">
        {%- for benefit in right_benefits -%}
          <div class="product-benefits__item">
            <div class="product-benefits__item-header">
              <span class="product-benefits__checkmark">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
              </span>
              <h3 class="product-benefits__title">{{ benefit.title }}</h3>
            </div>
            {%- if benefit.description != blank -%}
              <p class="product-benefits__description">{{ benefit.description | newline_to_br }}</p>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </div>
    </div>

    {%- comment -%} Mobile Layout - All Benefits Stacked {%- endcomment -%}
    <div class="product-benefits__mobile-content">
      {%- for benefit in benefits_list -%}
        <div class="product-benefits__item">
          <div class="product-benefits__item-header">
            <span class="product-benefits__checkmark">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
            </span>
            <h3 class="product-benefits__title">{{ benefit.title }}</h3>
          </div>
          {%- if benefit.description != blank -%}
            <p class="product-benefits__description">{{ benefit.description | newline_to_br }}</p>
          {%- endif -%}
        </div>
      {%- endfor -%}

      {%- comment -%} Mobile Image {%- endcomment -%}
      {%- if benefits_section.value.image != blank -%}
        <div class="product-benefits__image-container product-benefits__image-container--mobile">
          <div class="product-benefits__decorative-dots">
            {% render 'dots' %}
          </div>
          {{ benefits_section.value.image | image_url: width: 600 | image_tag: class: 'product-benefits__image', loading: 'lazy' }}
        </div>
      {%- endif -%}
    </div>
  </div>

  <style>
    #product-benefits-{{ section.id }} {
      background-color: #FFFFFF;
    }

    #product-benefits-{{ section.id }} .product-benefits__checkmark {
      {%- if benefits_section.value.heck_bg != blank -%}
        background-color: {{ benefits_section.value.heck_bg }};
      {%- endif -%}
    }

    #product-benefits-{{ section.id }} .product-benefits__checkmark svg {
      {%- if benefits_section.value.heck_mark != blank -%}
        fill: {{ benefits_section.value.heck_mark }};
      {%- endif -%}
    }

    #product-benefits-{{ section.id }} .product-benefits__decorative-dots-svg {
      {%- if benefits_section.value.dots != blank -%}
        color: {{ benefits_section.value.dots }};
      {%- endif -%}
    }

    {%- if benefits_section.value.gradient_1 != blank and benefits_section.value.gradient_2 != blank -%}
    {%- assign gradient_size = benefits_section.value.gradient_size | default: 150 -%}
    {%- assign gradient_blur = benefits_section.value.gradient_blur | default: 35 -%}
    #product-benefits-{{ section.id }} .product-benefits__decorative-dots::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: {{ gradient_size }}%;
      height: {{ gradient_size }}%;
      background: linear-gradient(258deg, {{ benefits_section.value.gradient_1 }} -3.86%, {{ benefits_section.value.gradient_2 }} 121.76%);
      border-radius: 50%;
      filter: blur({{ gradient_blur }}px);
      z-index: 2;
      pointer-events: none;
    }
    {%- endif -%}
  </style>
</section>
{%- endif -%}

{% schema %}
{
  "name": "Product Benefits",
  "tag": "section",
  "class": "product-benefits",
  "settings": [
    {
      "type": "paragraph",
      "content": "This section displays product benefits from the product metafield 'custom.product_benefits'. The section will be hidden if the metafield is empty."
    },
    {
      "type": "header",
      "content": "Instructions"
    },
    {
      "type": "paragraph",
      "content": "Configure benefits data in the product metafield: custom.product_benefits (metaobject type: benefits_section)"
    }
  ],
  "presets": [
    {
      "name": "Product Benefits"
    }
  ],
  "templates": ["product"]
}
{% endschema %}
